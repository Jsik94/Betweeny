<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="betweeny.mybatis.mapper.memberMapping">
  <!-- 회원가입 -->
  <insert id="memberInsert" parameterType="MemberDTO">
  	INSERT INTO users VALUES(
  	SEQ_USERS_NO.NEXTVAL,
  	#{id},
  	#{pwd},
  	#{name},
  	#{call},
  	#{gender},
  	#{email},
  	#{birth})
  </insert>
  <!-- 아이디 중복확인 -->
  <select id="idCheck" parameterType="String" resultType="int">
  	SELECT COUNT(*) FROM users WHERE user_uid=#{id}
  </select>
  <!-- 로그인 -->
  <select id="memberLogin" parameterType="Map" resultType="int">
  	SELECT COUNT(*) FROM users WHERE user_uid=#{id} AND user_pw=#{pwd}	
  </select>
  
  <!-- 자동로그인 -->
	<!--  alter table userTable add column sessionkey varchar(50) not null default 'none'; -->
	<!-- alter table userTable add column sessionlimit timestamp; -->
	<!--
	로그인된 경우 해당 세션id와 유효시간을 사용자 테이블에 세팅
	-->
	<update id="keepLogin">
	    UPDATE users SET sessionKey = #{sessionId}, sessionLimit = #{next} WHERE user_uid=#{id}
	</update>
	 
	<!--
	유효기간이 남아 있으면서 해당 sessionId를 가지는 사용자 정보를 꺼내오는 부분
	-->
	<select id="checkUserWithSessionKey" resultType="MemberDTO">
	    SELECT * FROM users WHERE sessionKey = #{sessionId} and sessionLimit > now()
	</select>
  
  	<!-- 회원정보 수정 -->
  	<select id="memberUpdate" parameterType="MemberDTO">
  		UPDATE users SET 
  		user_pw = #{pwd}, 
  		user_name = #{name}, 
  		user_call = #{call}, 
  		user_email = #{email}, 
  		user_birth = #{birth}
  		WHERE user_uid = #{id}
  	</select>
  	
  	<!-- 회원 탈퇴 -->
  	<delete id="memberDelete" parameterType="MemberDTO">
  		DELETE FROM users WHERE user_uid=#{id} AND user_pw=#{pwd}	
  	</delete>

	
</mapper>
  
  